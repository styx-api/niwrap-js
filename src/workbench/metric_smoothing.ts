// This file was auto generated by Styx.
// Do not edit this file directly.

import { Runner, Execution, Metadata, InputPathType, OutputPathType, getGlobalRunner } from 'styxdefs';

const METRIC_SMOOTHING_METADATA: Metadata = {
    id: "4cac13b0419558d62931d434fd4c5540aac0f7fe.workbench",
    name: "metric-smoothing",
    package: "workbench",
    container_image_tag: "nx10x/workbench:2.1.0",
};


interface MetricSmoothingRoiParamsDict {
    "@type"?: "roi";
    "roi-metric": InputPathType;
    "match-columns": boolean;
}
type MetricSmoothingRoiParamsDictTagged = Required<Pick<MetricSmoothingRoiParamsDict, '@type'>> & MetricSmoothingRoiParamsDict;


interface MetricSmoothingParamsDict {
    "@type"?: "workbench/metric-smoothing";
    "metric-out": string;
    "fwhm": boolean;
    "roi"?: MetricSmoothingRoiParamsDict | null | undefined;
    "fix-zeros": boolean;
    "column"?: string | null | undefined;
    "area-metric"?: InputPathType | null | undefined;
    "method"?: string | null | undefined;
    "surface": InputPathType;
    "metric-in": InputPathType;
    "smoothing-kernel": number;
}
type MetricSmoothingParamsDictTagged = Required<Pick<MetricSmoothingParamsDict, '@type'>> & MetricSmoothingParamsDict;


/**
 * Build parameters.
 *
 * @param roi_metric the roi to smooth within, as a metric
 * @param match_columns for each input column, use the corresponding column from the roi
 *
 * @returns Parameter dictionary
 */
function metric_smoothing_roi(
    roi_metric: InputPathType,
    match_columns: boolean = false,
): MetricSmoothingRoiParamsDictTagged {
    const params = {
        "@type": "roi" as const,
        "roi-metric": roi_metric,
        "match-columns": match_columns,
    };
    return params;
}


/**
 * Build command-line arguments from parameters.
 *
 * @param params The parameters.
 * @param execution The execution object for resolving input paths.
 *
 * @returns Command-line arguments.
 */
function metric_smoothing_roi_cargs(
    params: MetricSmoothingRoiParamsDict,
    execution: Execution,
): string[] {
    const cargs: string[] = [];
    if ((params["match-columns"] ?? false)) {
        cargs.push(
            "-roi",
            execution.inputFile((params["roi-metric"] ?? null)),
            "-match-columns"
        );
    }
    return cargs;
}


/**
 * Output object returned when calling `MetricSmoothingParamsDict(...)`.
 *
 * @interface
 */
interface MetricSmoothingOutputs {
    /**
     * Output root folder. This is the root folder for all outputs.
     */
    root: OutputPathType;
    /**
     * the output metric
     */
    metric_out: OutputPathType;
}


/**
 * Build parameters.
 *
 * @param metric_out the output metric
 * @param surface the surface to smooth on
 * @param metric_in the metric to smooth
 * @param smoothing_kernel the size of the gaussian smoothing kernel in mm, as sigma by default
 * @param fwhm kernel size is FWHM, not sigma
 * @param roi select a region of interest to smooth
 * @param fix_zeros treat zero values as not being data
 * @param column select a single column to smooth

the column number or name
 * @param area_metric vertex areas to use instead of computing them from the surface

the corrected vertex areas, as a metric
 * @param method select smoothing method, default GEO_GAUSS_AREA

the name of the smoothing method
 *
 * @returns Parameter dictionary
 */
function metric_smoothing_params(
    metric_out: string,
    surface: InputPathType,
    metric_in: InputPathType,
    smoothing_kernel: number,
    fwhm: boolean = false,
    roi: MetricSmoothingRoiParamsDict | null = null,
    fix_zeros: boolean = false,
    column: string | null = null,
    area_metric: InputPathType | null = null,
    method: string | null = null,
): MetricSmoothingParamsDictTagged {
    const params = {
        "@type": "workbench/metric-smoothing" as const,
        "metric-out": metric_out,
        "fwhm": fwhm,
        "fix-zeros": fix_zeros,
        "surface": surface,
        "metric-in": metric_in,
        "smoothing-kernel": smoothing_kernel,
    };
    if (roi !== null) {
        params["roi"] = roi;
    }
    if (column !== null) {
        params["column"] = column;
    }
    if (area_metric !== null) {
        params["area-metric"] = area_metric;
    }
    if (method !== null) {
        params["method"] = method;
    }
    return params;
}


/**
 * Build command-line arguments from parameters.
 *
 * @param params The parameters.
 * @param execution The execution object for resolving input paths.
 *
 * @returns Command-line arguments.
 */
function metric_smoothing_cargs(
    params: MetricSmoothingParamsDict,
    execution: Execution,
): string[] {
    const cargs: string[] = [];
    if ((params["fwhm"] ?? false) || (params["roi"] ?? null) !== null || (params["fix-zeros"] ?? false) || (params["column"] ?? null) !== null || (params["area-metric"] ?? null) !== null || (params["method"] ?? null) !== null) {
        cargs.push(
            "wb_command",
            "-metric-smoothing",
            (params["metric-out"] ?? null),
            (((params["fwhm"] ?? false)) ? "-fwhm" : ""),
            ...(((params["roi"] ?? null) !== null) ? metric_smoothing_roi_cargs((params["roi"] ?? null), execution) : []),
            (((params["fix-zeros"] ?? false)) ? "-fix-zeros" : ""),
            "-column",
            (((params["column"] ?? null) !== null) ? (params["column"] ?? null) : ""),
            "-corrected-areas",
            (((params["area-metric"] ?? null) !== null) ? execution.inputFile((params["area-metric"] ?? null)) : ""),
            "-method",
            (((params["method"] ?? null) !== null) ? (params["method"] ?? null) : "")
        );
    }
    cargs.push(execution.inputFile((params["surface"] ?? null)));
    cargs.push(execution.inputFile((params["metric-in"] ?? null)));
    cargs.push(String((params["smoothing-kernel"] ?? null)));
    return cargs;
}


/**
 * Build outputs object containing output file paths and possibly stdout/stderr.
 *
 * @param params The parameters.
 * @param execution The execution object for resolving input paths.
 *
 * @returns Outputs object.
 */
function metric_smoothing_outputs(
    params: MetricSmoothingParamsDict,
    execution: Execution,
): MetricSmoothingOutputs {
    const ret: MetricSmoothingOutputs = {
        root: execution.outputFile("."),
        metric_out: execution.outputFile([(params["metric-out"] ?? null)].join('')),
    };
    return ret;
}


/**
 * SMOOTH A METRIC FILE.
 *
 * Smooth a metric file on a surface.  By default, smooths all input columns on the entire surface, specify -column to use only one input column, and -roi to smooth only where the roi metric is greater than 0, outputting zeros elsewhere.
 *
 * When using -roi, input data outside the ROI is not used to compute the smoothed values.  By default, the first column of the roi metric is used for all input columns.  When -match-columns is specified to the -roi option, the input and roi metrics must have the same number of columns, and for each input column's index, the same column index is used in the roi metric.  If the -match-columns option to -roi is used while the -column option is also used, the number of columns must match between the roi and input metric, and it will use the roi column with the index of the selected input column.
 *
 * The -fix-zeros option causes the smoothing to not use an input value if it is zero, but still write a smoothed value to the vertex.  This is useful for zeros that indicate lack of information, preventing them from pulling down the intensity of nearby vertices, while giving the zero an extrapolated value.
 *
 * The -corrected-areas option is intended for when it is unavoidable to smooth on a group average surface, it is only an approximate correction for the reduction of structure in a group average surface.  It is better to smooth the data on individuals before averaging, when feasible.
 *
 * Valid values for <method> are:
 *
 * GEO_GAUSS_AREA - uses a geodesic gaussian kernel, and normalizes based on vertex area in order to work more reliably on irregular surfaces
 *
 * GEO_GAUSS_EQUAL - uses a geodesic gaussian kernel, and normalizes assuming each vertex has equal importance
 *
 * GEO_GAUSS - matches geodesic gaussian smoothing from caret5, but does not check kernels for having unequal importance
 *
 * The GEO_GAUSS_AREA method is the default because it is usually the correct choice.  GEO_GAUSS_EQUAL may be the correct choice when the sum of vertex values is more meaningful then the surface integral (sum of values .* areas), for instance when smoothing vertex areas (the sum is the total surface area, while the surface integral is the sum of squares of the vertex areas).  The GEO_GAUSS method is not recommended, it exists mainly to replicate methods of studies done with caret5's geodesic smoothing.
 *
 * @param params The parameters.
 * @param runner Command runner
 *
 * @returns NamedTuple of outputs (described in `MetricSmoothingOutputs`).
 */
function metric_smoothing_execute(
    params: MetricSmoothingParamsDict,
    runner: Runner | null = null,
): MetricSmoothingOutputs {
    runner = runner || getGlobalRunner();
    const execution = runner.startExecution(METRIC_SMOOTHING_METADATA);
    params = execution.params(params)
    const cargs = metric_smoothing_cargs(params, execution)
    const ret = metric_smoothing_outputs(params, execution)
    execution.run(cargs, undefined);
    return ret;
}


/**
 * SMOOTH A METRIC FILE.
 *
 * Smooth a metric file on a surface.  By default, smooths all input columns on the entire surface, specify -column to use only one input column, and -roi to smooth only where the roi metric is greater than 0, outputting zeros elsewhere.
 *
 * When using -roi, input data outside the ROI is not used to compute the smoothed values.  By default, the first column of the roi metric is used for all input columns.  When -match-columns is specified to the -roi option, the input and roi metrics must have the same number of columns, and for each input column's index, the same column index is used in the roi metric.  If the -match-columns option to -roi is used while the -column option is also used, the number of columns must match between the roi and input metric, and it will use the roi column with the index of the selected input column.
 *
 * The -fix-zeros option causes the smoothing to not use an input value if it is zero, but still write a smoothed value to the vertex.  This is useful for zeros that indicate lack of information, preventing them from pulling down the intensity of nearby vertices, while giving the zero an extrapolated value.
 *
 * The -corrected-areas option is intended for when it is unavoidable to smooth on a group average surface, it is only an approximate correction for the reduction of structure in a group average surface.  It is better to smooth the data on individuals before averaging, when feasible.
 *
 * Valid values for <method> are:
 *
 * GEO_GAUSS_AREA - uses a geodesic gaussian kernel, and normalizes based on vertex area in order to work more reliably on irregular surfaces
 *
 * GEO_GAUSS_EQUAL - uses a geodesic gaussian kernel, and normalizes assuming each vertex has equal importance
 *
 * GEO_GAUSS - matches geodesic gaussian smoothing from caret5, but does not check kernels for having unequal importance
 *
 * The GEO_GAUSS_AREA method is the default because it is usually the correct choice.  GEO_GAUSS_EQUAL may be the correct choice when the sum of vertex values is more meaningful then the surface integral (sum of values .* areas), for instance when smoothing vertex areas (the sum is the total surface area, while the surface integral is the sum of squares of the vertex areas).  The GEO_GAUSS method is not recommended, it exists mainly to replicate methods of studies done with caret5's geodesic smoothing.
 *
 * @param metric_out the output metric
 * @param surface the surface to smooth on
 * @param metric_in the metric to smooth
 * @param smoothing_kernel the size of the gaussian smoothing kernel in mm, as sigma by default
 * @param fwhm kernel size is FWHM, not sigma
 * @param roi select a region of interest to smooth
 * @param fix_zeros treat zero values as not being data
 * @param column select a single column to smooth

the column number or name
 * @param area_metric vertex areas to use instead of computing them from the surface

the corrected vertex areas, as a metric
 * @param method select smoothing method, default GEO_GAUSS_AREA

the name of the smoothing method
 * @param runner Command runner
 *
 * @returns NamedTuple of outputs (described in `MetricSmoothingOutputs`).
 */
function metric_smoothing(
    metric_out: string,
    surface: InputPathType,
    metric_in: InputPathType,
    smoothing_kernel: number,
    fwhm: boolean = false,
    roi: MetricSmoothingRoiParamsDict | null = null,
    fix_zeros: boolean = false,
    column: string | null = null,
    area_metric: InputPathType | null = null,
    method: string | null = null,
    runner: Runner | null = null,
): MetricSmoothingOutputs {
    const params = metric_smoothing_params(metric_out, surface, metric_in, smoothing_kernel, fwhm, roi, fix_zeros, column, area_metric, method)
    return metric_smoothing_execute(params, runner);
}


export {
      METRIC_SMOOTHING_METADATA,
      MetricSmoothingOutputs,
      MetricSmoothingParamsDict,
      MetricSmoothingParamsDictTagged,
      MetricSmoothingRoiParamsDict,
      MetricSmoothingRoiParamsDictTagged,
      metric_smoothing,
      metric_smoothing_execute,
      metric_smoothing_params,
      metric_smoothing_roi,
};
