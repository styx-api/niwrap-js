// This file was auto generated by Styx.
// Do not edit this file directly.

import { Runner, Execution, Metadata, InputPathType, OutputPathType, getGlobalRunner } from 'styxdefs';

const MRI_ROBUST_TEMPLATE_METADATA: Metadata = {
    id: "f043b3273e9985d357cf80355b397d8ee42c3a35.boutiques",
    name: "mri_robust_template",
    package: "freesurfer",
    container_image_tag: "freesurfer/freesurfer:7.4.1",
};


interface MriRobustTemplateParamsDict {
    "@type"?: "freesurfer/mri_robust_template";
    "mov": Array<InputPathType>;
    "template": string;
    "sat"?: number | null | undefined;
    "satit": boolean;
    "lta"?: Array<string> | null | undefined;
    "mapmov"?: Array<string> | null | undefined;
    "mapmovhdr"?: Array<string> | null | undefined;
    "weights"?: Array<string> | null | undefined;
    "oneminusw": boolean;
    "average"?: number | null | undefined;
    "inittp"?: number | null | undefined;
    "fixtp": boolean;
    "iscale": boolean;
    "iscaleonly": boolean;
    "iscalein"?: Array<InputPathType> | null | undefined;
    "iscaleout"?: Array<string> | null | undefined;
    "transonly": boolean;
    "affine": boolean;
    "ixforms"?: Array<InputPathType> | null | undefined;
    "masks"?: Array<InputPathType> | null | undefined;
    "vox2vox": boolean;
    "leastsquares": boolean;
    "noit": boolean;
    "maxit"?: number | null | undefined;
    "highit"?: number | null | undefined;
    "epsit"?: number | null | undefined;
    "pairmaxit"?: number | null | undefined;
    "pairepsit"?: number | null | undefined;
    "subsample"?: number | null | undefined;
    "nomulti": boolean;
    "floattype": boolean;
    "finalnearest": boolean;
    "doubleprec": boolean;
    "cras": boolean;
    "res_thresh"?: number | null | undefined;
    "frobnorm_thresh"?: number | null | undefined;
    "conform"?: string | null | undefined;
    "seed"?: number | null | undefined;
    "allow_diff_vox_size": boolean;
    "threads"?: number | null | undefined;
    "debug": boolean;
}
type MriRobustTemplateParamsDictTagged = Required<Pick<MriRobustTemplateParamsDict, '@type'>> & MriRobustTemplateParamsDict;


/**
 * Output object returned when calling `MriRobustTemplateParamsDict(...)`.
 *
 * @interface
 */
interface MriRobustTemplateOutputs {
    /**
     * Output root folder. This is the root folder for all outputs.
     */
    root: OutputPathType;
    /**
     * Output template volume (final mean/median image).
     */
    template_output: OutputPathType;
    /**
     * Output conformed template volume.
     */
    conform_output: OutputPathType | null;
}


/**
 * Build parameters.
 *
 * @param mov Input movable volumes to be aligned to common mean/median template (at least 2 required).
 * @param template Output template volume (final mean/median image).
 * @param sat Set outlier sensitivity manually. Higher values mean less sensitivity.
 * @param satit Auto-detect good sensitivity (recommended for head or full brain scans).
 * @param lta Output LTA transforms to template (one per input volume).
 * @param mapmov Output mapped and resampled images in template space (one per input volume).
 * @param mapmovhdr Output header-adjusted movable images (no resampling, only vox2ras adjusted).
 * @param weights Output weight volumes in template space (0=regular, 1=outlier).
 * @param oneminusw Invert outlier weight map (0=outlier), as in earlier versions.
 * @param average Construct template from: 0=mean, 1=median (default 1).
 * @param inittp Use timepoint number for spatial initialization (default: random). 0 constructs template from original volumes without initialization.
 * @param fixtp Map everything to initial timepoint (init TP is not resampled).
 * @param iscale Enable intensity scaling (default off).
 * @param iscaleonly Only perform intensity scaling (no spatial transformation).
 * @param iscalein Input initial intensity scale files.
 * @param iscaleout Output final intensity scale files (will activate --iscale).
 * @param transonly Find 3 parameter translation only.
 * @param affine Find 12 parameter affine transform.
 * @param ixforms Use initial LTA transforms on source ('id' for identity).
 * @param masks Input mask volumes applied to movable images.
 * @param vox2vox Output VOX2VOX LTA file (default is RAS2RAS).
 * @param leastsquares Use least squares instead of robust M-estimator (for testing only).
 * @param noit Do not iterate, just create first template.
 * @param maxit Maximum number of template iterations (default: 6 if >2 timepoints, 5 otherwise).
 * @param highit Maximum number of iterations on highest resolution (default: -1, use maxit).
 * @param epsit Stop template iterations when all transform updates fall below this value (default: -1.0, disabled).
 * @param pairmaxit Maximum number of iterations for pairwise registrations (default: 5).
 * @param pairepsit Stop pairwise registration iterations when transform updates fall below this value (default: 0.01).
 * @param subsample Subsample if voxel dimension exceeds this value on all axes (default: -1, disabled).
 * @param nomulti Do not use multi-resolution (process highest resolution only).
 * @param floattype Convert images to float internally (default: keep input type).
 * @param finalnearest Use nearest neighbor interpolation when creating the final average.
 * @param doubleprec Use double precision instead of float internally (large memory usage).
 * @param cras Center template at average CRAS instead of average barycenter.
 * @param res_thresh Volume resolution threshold in mm (default: 0.01).
 * @param frobnorm_thresh Matrix Frobenius norm threshold (default: 0.0001).
 * @param conform Output conformed template (256^3, 1mm isotropic voxels).
 * @param seed Set random seed for target selection (default: 0).
 * @param allow_diff_vox_size Allow input volumes with different voxel sizes.
 * @param threads Set number of OpenMP threads.
 * @param debug Show debug output.
 *
 * @returns Parameter dictionary
 */
function mri_robust_template_params(
    mov: Array<InputPathType>,
    template: string,
    sat: number | null = null,
    satit: boolean = false,
    lta: Array<string> | null = null,
    mapmov: Array<string> | null = null,
    mapmovhdr: Array<string> | null = null,
    weights: Array<string> | null = null,
    oneminusw: boolean = false,
    average: number | null = null,
    inittp: number | null = null,
    fixtp: boolean = false,
    iscale: boolean = false,
    iscaleonly: boolean = false,
    iscalein: Array<InputPathType> | null = null,
    iscaleout: Array<string> | null = null,
    transonly: boolean = false,
    affine: boolean = false,
    ixforms: Array<InputPathType> | null = null,
    masks: Array<InputPathType> | null = null,
    vox2vox: boolean = false,
    leastsquares: boolean = false,
    noit: boolean = false,
    maxit: number | null = null,
    highit: number | null = null,
    epsit: number | null = null,
    pairmaxit: number | null = null,
    pairepsit: number | null = null,
    subsample: number | null = null,
    nomulti: boolean = false,
    floattype: boolean = false,
    finalnearest: boolean = false,
    doubleprec: boolean = false,
    cras: boolean = false,
    res_thresh: number | null = null,
    frobnorm_thresh: number | null = null,
    conform: string | null = null,
    seed: number | null = null,
    allow_diff_vox_size: boolean = false,
    threads: number | null = null,
    debug: boolean = false,
): MriRobustTemplateParamsDictTagged {
    const params = {
        "@type": "freesurfer/mri_robust_template" as const,
        "mov": mov,
        "template": template,
        "satit": satit,
        "oneminusw": oneminusw,
        "fixtp": fixtp,
        "iscale": iscale,
        "iscaleonly": iscaleonly,
        "transonly": transonly,
        "affine": affine,
        "vox2vox": vox2vox,
        "leastsquares": leastsquares,
        "noit": noit,
        "nomulti": nomulti,
        "floattype": floattype,
        "finalnearest": finalnearest,
        "doubleprec": doubleprec,
        "cras": cras,
        "allow_diff_vox_size": allow_diff_vox_size,
        "debug": debug,
    };
    if (sat !== null) {
        params["sat"] = sat;
    }
    if (lta !== null) {
        params["lta"] = lta;
    }
    if (mapmov !== null) {
        params["mapmov"] = mapmov;
    }
    if (mapmovhdr !== null) {
        params["mapmovhdr"] = mapmovhdr;
    }
    if (weights !== null) {
        params["weights"] = weights;
    }
    if (average !== null) {
        params["average"] = average;
    }
    if (inittp !== null) {
        params["inittp"] = inittp;
    }
    if (iscalein !== null) {
        params["iscalein"] = iscalein;
    }
    if (iscaleout !== null) {
        params["iscaleout"] = iscaleout;
    }
    if (ixforms !== null) {
        params["ixforms"] = ixforms;
    }
    if (masks !== null) {
        params["masks"] = masks;
    }
    if (maxit !== null) {
        params["maxit"] = maxit;
    }
    if (highit !== null) {
        params["highit"] = highit;
    }
    if (epsit !== null) {
        params["epsit"] = epsit;
    }
    if (pairmaxit !== null) {
        params["pairmaxit"] = pairmaxit;
    }
    if (pairepsit !== null) {
        params["pairepsit"] = pairepsit;
    }
    if (subsample !== null) {
        params["subsample"] = subsample;
    }
    if (res_thresh !== null) {
        params["res_thresh"] = res_thresh;
    }
    if (frobnorm_thresh !== null) {
        params["frobnorm_thresh"] = frobnorm_thresh;
    }
    if (conform !== null) {
        params["conform"] = conform;
    }
    if (seed !== null) {
        params["seed"] = seed;
    }
    if (threads !== null) {
        params["threads"] = threads;
    }
    return params;
}


/**
 * Build command-line arguments from parameters.
 *
 * @param params The parameters.
 * @param execution The execution object for resolving input paths.
 *
 * @returns Command-line arguments.
 */
function mri_robust_template_cargs(
    params: MriRobustTemplateParamsDict,
    execution: Execution,
): string[] {
    const cargs: string[] = [];
    cargs.push("mri_robust_template");
    cargs.push(
        "--mov",
        ...(params["mov"] ?? null).map(f => execution.inputFile(f))
    );
    cargs.push(
        "--template",
        (params["template"] ?? null)
    );
    if ((params["sat"] ?? null) !== null) {
        cargs.push(
            "--sat",
            String((params["sat"] ?? null))
        );
    }
    if ((params["satit"] ?? false)) {
        cargs.push("--satit");
    }
    if ((params["lta"] ?? null) !== null) {
        cargs.push(
            "--lta",
            ...(params["lta"] ?? null)
        );
    }
    if ((params["mapmov"] ?? null) !== null) {
        cargs.push(
            "--mapmov",
            ...(params["mapmov"] ?? null)
        );
    }
    if ((params["mapmovhdr"] ?? null) !== null) {
        cargs.push(
            "--mapmovhdr",
            ...(params["mapmovhdr"] ?? null)
        );
    }
    if ((params["weights"] ?? null) !== null) {
        cargs.push(
            "--weights",
            ...(params["weights"] ?? null)
        );
    }
    if ((params["oneminusw"] ?? false)) {
        cargs.push("--oneminusw");
    }
    if ((params["average"] ?? null) !== null) {
        cargs.push(
            "--average",
            String((params["average"] ?? null))
        );
    }
    if ((params["inittp"] ?? null) !== null) {
        cargs.push(
            "--inittp",
            String((params["inittp"] ?? null))
        );
    }
    if ((params["fixtp"] ?? false)) {
        cargs.push("--fixtp");
    }
    if ((params["iscale"] ?? false)) {
        cargs.push("--iscale");
    }
    if ((params["iscaleonly"] ?? false)) {
        cargs.push("--iscaleonly");
    }
    if ((params["iscalein"] ?? null) !== null) {
        cargs.push(
            "--iscalein",
            ...(params["iscalein"] ?? null).map(f => execution.inputFile(f))
        );
    }
    if ((params["iscaleout"] ?? null) !== null) {
        cargs.push(
            "--iscaleout",
            ...(params["iscaleout"] ?? null)
        );
    }
    if ((params["transonly"] ?? false)) {
        cargs.push("--transonly");
    }
    if ((params["affine"] ?? false)) {
        cargs.push("--affine");
    }
    if ((params["ixforms"] ?? null) !== null) {
        cargs.push(
            "--ixforms",
            ...(params["ixforms"] ?? null).map(f => execution.inputFile(f))
        );
    }
    if ((params["masks"] ?? null) !== null) {
        cargs.push(
            "--masks",
            ...(params["masks"] ?? null).map(f => execution.inputFile(f))
        );
    }
    if ((params["vox2vox"] ?? false)) {
        cargs.push("--vox2vox");
    }
    if ((params["leastsquares"] ?? false)) {
        cargs.push("--leastsquares");
    }
    if ((params["noit"] ?? false)) {
        cargs.push("--noit");
    }
    if ((params["maxit"] ?? null) !== null) {
        cargs.push(
            "--maxit",
            String((params["maxit"] ?? null))
        );
    }
    if ((params["highit"] ?? null) !== null) {
        cargs.push(
            "--highit",
            String((params["highit"] ?? null))
        );
    }
    if ((params["epsit"] ?? null) !== null) {
        cargs.push(
            "--epsit",
            String((params["epsit"] ?? null))
        );
    }
    if ((params["pairmaxit"] ?? null) !== null) {
        cargs.push(
            "--pairmaxit",
            String((params["pairmaxit"] ?? null))
        );
    }
    if ((params["pairepsit"] ?? null) !== null) {
        cargs.push(
            "--pairepsit",
            String((params["pairepsit"] ?? null))
        );
    }
    if ((params["subsample"] ?? null) !== null) {
        cargs.push(
            "--subsample",
            String((params["subsample"] ?? null))
        );
    }
    if ((params["nomulti"] ?? false)) {
        cargs.push("--nomulti");
    }
    if ((params["floattype"] ?? false)) {
        cargs.push("--floattype");
    }
    if ((params["finalnearest"] ?? false)) {
        cargs.push("--finalnearest");
    }
    if ((params["doubleprec"] ?? false)) {
        cargs.push("--doubleprec");
    }
    if ((params["cras"] ?? false)) {
        cargs.push("--cras");
    }
    if ((params["res_thresh"] ?? null) !== null) {
        cargs.push(
            "--res-thresh",
            String((params["res_thresh"] ?? null))
        );
    }
    if ((params["frobnorm_thresh"] ?? null) !== null) {
        cargs.push(
            "--frobnorm-thresh",
            String((params["frobnorm_thresh"] ?? null))
        );
    }
    if ((params["conform"] ?? null) !== null) {
        cargs.push(
            "--conform",
            (params["conform"] ?? null)
        );
    }
    if ((params["seed"] ?? null) !== null) {
        cargs.push(
            "--seed",
            String((params["seed"] ?? null))
        );
    }
    if ((params["allow_diff_vox_size"] ?? false)) {
        cargs.push("--allow-diff-vox-size");
    }
    if ((params["threads"] ?? null) !== null) {
        cargs.push(
            "--threads",
            String((params["threads"] ?? null))
        );
    }
    if ((params["debug"] ?? false)) {
        cargs.push("--debug");
    }
    return cargs;
}


/**
 * Build outputs object containing output file paths and possibly stdout/stderr.
 *
 * @param params The parameters.
 * @param execution The execution object for resolving input paths.
 *
 * @returns Outputs object.
 */
function mri_robust_template_outputs(
    params: MriRobustTemplateParamsDict,
    execution: Execution,
): MriRobustTemplateOutputs {
    const ret: MriRobustTemplateOutputs = {
        root: execution.outputFile("."),
        template_output: execution.outputFile([(params["template"] ?? null)].join('')),
        conform_output: ((params["conform"] ?? null) !== null) ? execution.outputFile([(params["conform"] ?? null)].join('')) : null,
    };
    return ret;
}


/**
 * mri_robust_template
 *
 * Constructs an unbiased robust template for longitudinal volumes using an iterative method.
 *
 * Author: FreeSurfer Developers
 *
 * URL: https://github.com/freesurfer/freesurfer
 *
 * @param params The parameters.
 * @param runner Command runner
 *
 * @returns NamedTuple of outputs (described in `MriRobustTemplateOutputs`).
 */
function mri_robust_template_execute(
    params: MriRobustTemplateParamsDict,
    runner: Runner | null = null,
): MriRobustTemplateOutputs {
    runner = runner || getGlobalRunner();
    const execution = runner.startExecution(MRI_ROBUST_TEMPLATE_METADATA);
    params = execution.params(params)
    const cargs = mri_robust_template_cargs(params, execution)
    const ret = mri_robust_template_outputs(params, execution)
    execution.run(cargs, undefined);
    return ret;
}


/**
 * mri_robust_template
 *
 * Constructs an unbiased robust template for longitudinal volumes using an iterative method.
 *
 * Author: FreeSurfer Developers
 *
 * URL: https://github.com/freesurfer/freesurfer
 *
 * @param mov Input movable volumes to be aligned to common mean/median template (at least 2 required).
 * @param template Output template volume (final mean/median image).
 * @param sat Set outlier sensitivity manually. Higher values mean less sensitivity.
 * @param satit Auto-detect good sensitivity (recommended for head or full brain scans).
 * @param lta Output LTA transforms to template (one per input volume).
 * @param mapmov Output mapped and resampled images in template space (one per input volume).
 * @param mapmovhdr Output header-adjusted movable images (no resampling, only vox2ras adjusted).
 * @param weights Output weight volumes in template space (0=regular, 1=outlier).
 * @param oneminusw Invert outlier weight map (0=outlier), as in earlier versions.
 * @param average Construct template from: 0=mean, 1=median (default 1).
 * @param inittp Use timepoint number for spatial initialization (default: random). 0 constructs template from original volumes without initialization.
 * @param fixtp Map everything to initial timepoint (init TP is not resampled).
 * @param iscale Enable intensity scaling (default off).
 * @param iscaleonly Only perform intensity scaling (no spatial transformation).
 * @param iscalein Input initial intensity scale files.
 * @param iscaleout Output final intensity scale files (will activate --iscale).
 * @param transonly Find 3 parameter translation only.
 * @param affine Find 12 parameter affine transform.
 * @param ixforms Use initial LTA transforms on source ('id' for identity).
 * @param masks Input mask volumes applied to movable images.
 * @param vox2vox Output VOX2VOX LTA file (default is RAS2RAS).
 * @param leastsquares Use least squares instead of robust M-estimator (for testing only).
 * @param noit Do not iterate, just create first template.
 * @param maxit Maximum number of template iterations (default: 6 if >2 timepoints, 5 otherwise).
 * @param highit Maximum number of iterations on highest resolution (default: -1, use maxit).
 * @param epsit Stop template iterations when all transform updates fall below this value (default: -1.0, disabled).
 * @param pairmaxit Maximum number of iterations for pairwise registrations (default: 5).
 * @param pairepsit Stop pairwise registration iterations when transform updates fall below this value (default: 0.01).
 * @param subsample Subsample if voxel dimension exceeds this value on all axes (default: -1, disabled).
 * @param nomulti Do not use multi-resolution (process highest resolution only).
 * @param floattype Convert images to float internally (default: keep input type).
 * @param finalnearest Use nearest neighbor interpolation when creating the final average.
 * @param doubleprec Use double precision instead of float internally (large memory usage).
 * @param cras Center template at average CRAS instead of average barycenter.
 * @param res_thresh Volume resolution threshold in mm (default: 0.01).
 * @param frobnorm_thresh Matrix Frobenius norm threshold (default: 0.0001).
 * @param conform Output conformed template (256^3, 1mm isotropic voxels).
 * @param seed Set random seed for target selection (default: 0).
 * @param allow_diff_vox_size Allow input volumes with different voxel sizes.
 * @param threads Set number of OpenMP threads.
 * @param debug Show debug output.
 * @param runner Command runner
 *
 * @returns NamedTuple of outputs (described in `MriRobustTemplateOutputs`).
 */
function mri_robust_template(
    mov: Array<InputPathType>,
    template: string,
    sat: number | null = null,
    satit: boolean = false,
    lta: Array<string> | null = null,
    mapmov: Array<string> | null = null,
    mapmovhdr: Array<string> | null = null,
    weights: Array<string> | null = null,
    oneminusw: boolean = false,
    average: number | null = null,
    inittp: number | null = null,
    fixtp: boolean = false,
    iscale: boolean = false,
    iscaleonly: boolean = false,
    iscalein: Array<InputPathType> | null = null,
    iscaleout: Array<string> | null = null,
    transonly: boolean = false,
    affine: boolean = false,
    ixforms: Array<InputPathType> | null = null,
    masks: Array<InputPathType> | null = null,
    vox2vox: boolean = false,
    leastsquares: boolean = false,
    noit: boolean = false,
    maxit: number | null = null,
    highit: number | null = null,
    epsit: number | null = null,
    pairmaxit: number | null = null,
    pairepsit: number | null = null,
    subsample: number | null = null,
    nomulti: boolean = false,
    floattype: boolean = false,
    finalnearest: boolean = false,
    doubleprec: boolean = false,
    cras: boolean = false,
    res_thresh: number | null = null,
    frobnorm_thresh: number | null = null,
    conform: string | null = null,
    seed: number | null = null,
    allow_diff_vox_size: boolean = false,
    threads: number | null = null,
    debug: boolean = false,
    runner: Runner | null = null,
): MriRobustTemplateOutputs {
    const params = mri_robust_template_params(mov, template, sat, satit, lta, mapmov, mapmovhdr, weights, oneminusw, average, inittp, fixtp, iscale, iscaleonly, iscalein, iscaleout, transonly, affine, ixforms, masks, vox2vox, leastsquares, noit, maxit, highit, epsit, pairmaxit, pairepsit, subsample, nomulti, floattype, finalnearest, doubleprec, cras, res_thresh, frobnorm_thresh, conform, seed, allow_diff_vox_size, threads, debug)
    return mri_robust_template_execute(params, runner);
}


export {
      MRI_ROBUST_TEMPLATE_METADATA,
      MriRobustTemplateOutputs,
      MriRobustTemplateParamsDict,
      MriRobustTemplateParamsDictTagged,
      mri_robust_template,
      mri_robust_template_execute,
      mri_robust_template_params,
};
