// This file was auto generated by Styx.
// Do not edit this file directly.

import { Runner, Execution, Metadata, InputPathType, OutputPathType, getGlobalRunner } from 'styxdefs';

const VOLUME_GRADIENT_METADATA: Metadata = {
    id: "5a5d7ede042330cd65eec319159b5ecf75f94aed.workbench",
    name: "volume-gradient",
    package: "workbench",
    container_image_tag: "nx10x/workbench:2.1.0",
};


interface VolumeGradientPresmoothParamsDict {
    "@type"?: "presmooth";
    "kernel": number;
    "fwhm": boolean;
}
type VolumeGradientPresmoothParamsDictTagged = Required<Pick<VolumeGradientPresmoothParamsDict, '@type'>> & VolumeGradientPresmoothParamsDict;


interface VolumeGradientVectorsParamsDict {
    "@type"?: "vectors";
    "vector-volume-out": string;
}
type VolumeGradientVectorsParamsDictTagged = Required<Pick<VolumeGradientVectorsParamsDict, '@type'>> & VolumeGradientVectorsParamsDict;


interface VolumeGradientParamsDict {
    "@type"?: "workbench/volume-gradient";
    "volume-out": string;
    "presmooth"?: VolumeGradientPresmoothParamsDict | null | undefined;
    "vectors"?: VolumeGradientVectorsParamsDict | null | undefined;
    "subvol"?: string | null | undefined;
    "roi-volume"?: InputPathType | null | undefined;
    "volume-in": InputPathType;
}
type VolumeGradientParamsDictTagged = Required<Pick<VolumeGradientParamsDict, '@type'>> & VolumeGradientParamsDict;


/**
 * Build parameters.
 *
 * @param kernel the size of the gaussian smoothing kernel in mm, as sigma by default
 * @param fwhm kernel size is FWHM, not sigma
 *
 * @returns Parameter dictionary
 */
function volume_gradient_presmooth(
    kernel: number,
    fwhm: boolean = false,
): VolumeGradientPresmoothParamsDictTagged {
    const params = {
        "@type": "presmooth" as const,
        "kernel": kernel,
        "fwhm": fwhm,
    };
    return params;
}


/**
 * Build command-line arguments from parameters.
 *
 * @param params The parameters.
 * @param execution The execution object for resolving input paths.
 *
 * @returns Command-line arguments.
 */
function volume_gradient_presmooth_cargs(
    params: VolumeGradientPresmoothParamsDict,
    execution: Execution,
): string[] {
    const cargs: string[] = [];
    cargs.push(
        "-presmooth",
        String((params["kernel"] ?? null))
    );
    if ((params["fwhm"] ?? false)) {
        cargs.push("-fwhm");
    }
    return cargs;
}


/**
 * Output object returned when calling `VolumeGradientVectorsParamsDict | null(...)`.
 *
 * @interface
 */
interface VolumeGradientVectorsOutputs {
    /**
     * Output root folder. This is the root folder for all outputs.
     */
    root: OutputPathType;
    /**
     * the vectors as a volume file
     */
    vector_volume_out: OutputPathType;
}


/**
 * Build parameters.
 *
 * @param vector_volume_out the vectors as a volume file
 *
 * @returns Parameter dictionary
 */
function volume_gradient_vectors(
    vector_volume_out: string,
): VolumeGradientVectorsParamsDictTagged {
    const params = {
        "@type": "vectors" as const,
        "vector-volume-out": vector_volume_out,
    };
    return params;
}


/**
 * Build command-line arguments from parameters.
 *
 * @param params The parameters.
 * @param execution The execution object for resolving input paths.
 *
 * @returns Command-line arguments.
 */
function volume_gradient_vectors_cargs(
    params: VolumeGradientVectorsParamsDict,
    execution: Execution,
): string[] {
    const cargs: string[] = [];
    cargs.push(
        "-vectors",
        (params["vector-volume-out"] ?? null)
    );
    return cargs;
}


/**
 * Build outputs object containing output file paths and possibly stdout/stderr.
 *
 * @param params The parameters.
 * @param execution The execution object for resolving input paths.
 *
 * @returns Outputs object.
 */
function volume_gradient_vectors_outputs(
    params: VolumeGradientVectorsParamsDict,
    execution: Execution,
): VolumeGradientVectorsOutputs {
    const ret: VolumeGradientVectorsOutputs = {
        root: execution.outputFile("."),
        vector_volume_out: execution.outputFile([(params["vector-volume-out"] ?? null)].join('')),
    };
    return ret;
}


/**
 * Output object returned when calling `VolumeGradientParamsDict(...)`.
 *
 * @interface
 */
interface VolumeGradientOutputs {
    /**
     * Output root folder. This is the root folder for all outputs.
     */
    root: OutputPathType;
    /**
     * the output gradient magnitude volume
     */
    volume_out: OutputPathType;
    /**
     * Outputs from `volume_gradient_vectors_outputs`.
     */
    vectors: VolumeGradientVectorsOutputs | null;
}


/**
 * Build parameters.
 *
 * @param volume_out the output gradient magnitude volume
 * @param volume_in the input volume
 * @param presmooth smooth the volume before computing the gradient
 * @param vectors output vectors
 * @param subvol select a single subvolume to take the gradient of

the subvolume number or name
 * @param roi_volume select a region of interest to take the gradient of

the region to take the gradient within
 *
 * @returns Parameter dictionary
 */
function volume_gradient_params(
    volume_out: string,
    volume_in: InputPathType,
    presmooth: VolumeGradientPresmoothParamsDict | null = null,
    vectors: VolumeGradientVectorsParamsDict | null = null,
    subvol: string | null = null,
    roi_volume: InputPathType | null = null,
): VolumeGradientParamsDictTagged {
    const params = {
        "@type": "workbench/volume-gradient" as const,
        "volume-out": volume_out,
        "volume-in": volume_in,
    };
    if (presmooth !== null) {
        params["presmooth"] = presmooth;
    }
    if (vectors !== null) {
        params["vectors"] = vectors;
    }
    if (subvol !== null) {
        params["subvol"] = subvol;
    }
    if (roi_volume !== null) {
        params["roi-volume"] = roi_volume;
    }
    return params;
}


/**
 * Build command-line arguments from parameters.
 *
 * @param params The parameters.
 * @param execution The execution object for resolving input paths.
 *
 * @returns Command-line arguments.
 */
function volume_gradient_cargs(
    params: VolumeGradientParamsDict,
    execution: Execution,
): string[] {
    const cargs: string[] = [];
    cargs.push(
        "wb_command",
        "-volume-gradient"
    );
    cargs.push(
        (params["volume-out"] ?? null),
        ...(((params["presmooth"] ?? null) !== null) ? volume_gradient_presmooth_cargs((params["presmooth"] ?? null), execution) : []),
        ...(((params["vectors"] ?? null) !== null) ? volume_gradient_vectors_cargs((params["vectors"] ?? null), execution) : [])
    );
    if ((params["subvol"] ?? null) !== null) {
        cargs.push(
            "-subvolume",
            (params["subvol"] ?? null)
        );
    }
    if ((params["roi-volume"] ?? null) !== null) {
        cargs.push(
            "-roi",
            execution.inputFile((params["roi-volume"] ?? null))
        );
    }
    cargs.push(execution.inputFile((params["volume-in"] ?? null)));
    return cargs;
}


/**
 * Build outputs object containing output file paths and possibly stdout/stderr.
 *
 * @param params The parameters.
 * @param execution The execution object for resolving input paths.
 *
 * @returns Outputs object.
 */
function volume_gradient_outputs(
    params: VolumeGradientParamsDict,
    execution: Execution,
): VolumeGradientOutputs {
    const ret: VolumeGradientOutputs = {
        root: execution.outputFile("."),
        volume_out: execution.outputFile([(params["volume-out"] ?? null)].join('')),
        vectors: (params["vectors"] ?? null) ? (volume_gradient_vectors_outputs((params["vectors"] ?? null), execution) ?? null) : null,
    };
    return ret;
}


/**
 * GRADIENT OF A VOLUME FILE.
 *
 * Computes the gradient of the volume by doing linear regressions for each voxel, considering only its face neighbors unless too few face neighbors exist.  The gradient vector is constructed from the partial derivatives of the resulting linear function, and the magnitude of this vector is the output.  If specified, the volume vector output is arranged with the x, y, and z components from a subvolume as consecutive subvolumes.
 *
 * @param params The parameters.
 * @param runner Command runner
 *
 * @returns NamedTuple of outputs (described in `VolumeGradientOutputs`).
 */
function volume_gradient_execute(
    params: VolumeGradientParamsDict,
    runner: Runner | null = null,
): VolumeGradientOutputs {
    runner = runner || getGlobalRunner();
    const execution = runner.startExecution(VOLUME_GRADIENT_METADATA);
    params = execution.params(params)
    const cargs = volume_gradient_cargs(params, execution)
    const ret = volume_gradient_outputs(params, execution)
    execution.run(cargs, undefined);
    return ret;
}


/**
 * GRADIENT OF A VOLUME FILE.
 *
 * Computes the gradient of the volume by doing linear regressions for each voxel, considering only its face neighbors unless too few face neighbors exist.  The gradient vector is constructed from the partial derivatives of the resulting linear function, and the magnitude of this vector is the output.  If specified, the volume vector output is arranged with the x, y, and z components from a subvolume as consecutive subvolumes.
 *
 * @param volume_out the output gradient magnitude volume
 * @param volume_in the input volume
 * @param presmooth smooth the volume before computing the gradient
 * @param vectors output vectors
 * @param subvol select a single subvolume to take the gradient of

the subvolume number or name
 * @param roi_volume select a region of interest to take the gradient of

the region to take the gradient within
 * @param runner Command runner
 *
 * @returns NamedTuple of outputs (described in `VolumeGradientOutputs`).
 */
function volume_gradient(
    volume_out: string,
    volume_in: InputPathType,
    presmooth: VolumeGradientPresmoothParamsDict | null = null,
    vectors: VolumeGradientVectorsParamsDict | null = null,
    subvol: string | null = null,
    roi_volume: InputPathType | null = null,
    runner: Runner | null = null,
): VolumeGradientOutputs {
    const params = volume_gradient_params(volume_out, volume_in, presmooth, vectors, subvol, roi_volume)
    return volume_gradient_execute(params, runner);
}


export {
      VOLUME_GRADIENT_METADATA,
      VolumeGradientOutputs,
      VolumeGradientParamsDict,
      VolumeGradientParamsDictTagged,
      VolumeGradientPresmoothParamsDict,
      VolumeGradientPresmoothParamsDictTagged,
      VolumeGradientVectorsOutputs,
      VolumeGradientVectorsParamsDict,
      VolumeGradientVectorsParamsDictTagged,
      volume_gradient,
      volume_gradient_execute,
      volume_gradient_params,
      volume_gradient_presmooth,
      volume_gradient_vectors,
};
