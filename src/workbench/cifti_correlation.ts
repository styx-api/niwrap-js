// This file was auto generated by Styx.
// Do not edit this file directly.

import { Runner, Execution, Metadata, InputPathType, OutputPathType, getGlobalRunner } from 'styxdefs';

const CIFTI_CORRELATION_METADATA: Metadata = {
    id: "dcfca8ed7e2b49948aa64aa87d5693dc899aee50.workbench",
    name: "cifti-correlation",
    package: "workbench",
    container_image_tag: "nx10x/workbench:2.1.0",
};


interface CiftiCorrelationRoiOverrideParamsDict {
    "@type"?: "roi-override";
    "roi-metric"?: InputPathType | null | undefined;
    "roi-metric"?: InputPathType | null | undefined;
    "roi-metric"?: InputPathType | null | undefined;
    "roi-vol"?: InputPathType | null | undefined;
    "roi-cifti"?: InputPathType | null | undefined;
}
type CiftiCorrelationRoiOverrideParamsDictTagged = Required<Pick<CiftiCorrelationRoiOverrideParamsDict, '@type'>> & CiftiCorrelationRoiOverrideParamsDict;


interface CiftiCorrelationParamsDict {
    "@type"?: "workbench/cifti-correlation";
    "cifti-out": string;
    "roi-override"?: CiftiCorrelationRoiOverrideParamsDict | null | undefined;
    "weight-file"?: string | null | undefined;
    "fisher-z": boolean;
    "no-demean": boolean;
    "covariance": boolean;
    "limit-GB"?: number | null | undefined;
    "cifti": InputPathType;
}
type CiftiCorrelationParamsDictTagged = Required<Pick<CiftiCorrelationParamsDict, '@type'>> & CiftiCorrelationParamsDict;


/**
 * Build parameters.
 *
 * @param roi_metric use an roi for left hempsphere

the left roi as a metric file
 * @param roi_metric_ use an roi for right hempsphere

the right roi as a metric file
 * @param roi_metric_2 use an roi for cerebellum

the cerebellum roi as a metric file
 * @param roi_vol use an roi for volume

the volume roi file
 * @param roi_cifti use a cifti file for combined rois

the cifti roi file
 *
 * @returns Parameter dictionary
 */
function cifti_correlation_roi_override(
    roi_metric: InputPathType | null = null,
    roi_metric_: InputPathType | null = null,
    roi_metric_2: InputPathType | null = null,
    roi_vol: InputPathType | null = null,
    roi_cifti: InputPathType | null = null,
): CiftiCorrelationRoiOverrideParamsDictTagged {
    const params = {
        "@type": "roi-override" as const,
    };
    if (roi_metric !== null) {
        params["roi-metric"] = roi_metric;
    }
    if (roi_metric_ !== null) {
        params["roi-metric"] = roi_metric_;
    }
    if (roi_metric_2 !== null) {
        params["roi-metric"] = roi_metric_2;
    }
    if (roi_vol !== null) {
        params["roi-vol"] = roi_vol;
    }
    if (roi_cifti !== null) {
        params["roi-cifti"] = roi_cifti;
    }
    return params;
}


/**
 * Build command-line arguments from parameters.
 *
 * @param params The parameters.
 * @param execution The execution object for resolving input paths.
 *
 * @returns Command-line arguments.
 */
function cifti_correlation_roi_override_cargs(
    params: CiftiCorrelationRoiOverrideParamsDict,
    execution: Execution,
): string[] {
    const cargs: string[] = [];
    if ((params["roi-metric"] ?? null) !== null || (params["roi-metric"] ?? null) !== null || (params["roi-metric"] ?? null) !== null || (params["roi-vol"] ?? null) !== null || (params["roi-cifti"] ?? null) !== null) {
        cargs.push(
            "-roi-override",
            "-left-roi",
            (((params["roi-metric"] ?? null) !== null) ? execution.inputFile((params["roi-metric"] ?? null)) : ""),
            "-right-roi",
            (((params["roi-metric"] ?? null) !== null) ? execution.inputFile((params["roi-metric"] ?? null)) : ""),
            "-cerebellum-roi",
            (((params["roi-metric"] ?? null) !== null) ? execution.inputFile((params["roi-metric"] ?? null)) : ""),
            "-vol-roi",
            (((params["roi-vol"] ?? null) !== null) ? execution.inputFile((params["roi-vol"] ?? null)) : ""),
            "-cifti-roi",
            (((params["roi-cifti"] ?? null) !== null) ? execution.inputFile((params["roi-cifti"] ?? null)) : "")
        );
    }
    return cargs;
}


/**
 * Output object returned when calling `CiftiCorrelationParamsDict(...)`.
 *
 * @interface
 */
interface CiftiCorrelationOutputs {
    /**
     * Output root folder. This is the root folder for all outputs.
     */
    root: OutputPathType;
    /**
     * output cifti file
     */
    cifti_out: OutputPathType;
}


/**
 * Build parameters.
 *
 * @param cifti_out output cifti file
 * @param cifti input cifti file
 * @param roi_override perform correlation from a subset of rows to all rows
 * @param weight_file specify column weights

text file containing one weight per column
 * @param fisher_z apply fisher small z transform (ie, artanh) to correlation
 * @param no_demean instead of correlation, do dot product of rows, then normalize by diagonal
 * @param covariance compute covariance instead of correlation
 * @param limit_gb restrict memory usage

memory limit in gigabytes
 *
 * @returns Parameter dictionary
 */
function cifti_correlation_params(
    cifti_out: string,
    cifti: InputPathType,
    roi_override: CiftiCorrelationRoiOverrideParamsDict | null = null,
    weight_file: string | null = null,
    fisher_z: boolean = false,
    no_demean: boolean = false,
    covariance: boolean = false,
    limit_gb: number | null = null,
): CiftiCorrelationParamsDictTagged {
    const params = {
        "@type": "workbench/cifti-correlation" as const,
        "cifti-out": cifti_out,
        "fisher-z": fisher_z,
        "no-demean": no_demean,
        "covariance": covariance,
        "cifti": cifti,
    };
    if (roi_override !== null) {
        params["roi-override"] = roi_override;
    }
    if (weight_file !== null) {
        params["weight-file"] = weight_file;
    }
    if (limit_gb !== null) {
        params["limit-GB"] = limit_gb;
    }
    return params;
}


/**
 * Build command-line arguments from parameters.
 *
 * @param params The parameters.
 * @param execution The execution object for resolving input paths.
 *
 * @returns Command-line arguments.
 */
function cifti_correlation_cargs(
    params: CiftiCorrelationParamsDict,
    execution: Execution,
): string[] {
    const cargs: string[] = [];
    cargs.push(
        "wb_command",
        "-cifti-correlation",
        (params["cifti-out"] ?? null),
        ...cifti_correlation_roi_override_cargs((params["roi-override"] ?? null), execution),
        "-weights",
        (params["weight-file"] ?? null),
        "-fisher-z",
        "-no-demean",
        "-covariance",
        "-mem-limit",
        String((params["limit-GB"] ?? null))
    );
    cargs.push(execution.inputFile((params["cifti"] ?? null)));
    return cargs;
}


/**
 * Build outputs object containing output file paths and possibly stdout/stderr.
 *
 * @param params The parameters.
 * @param execution The execution object for resolving input paths.
 *
 * @returns Outputs object.
 */
function cifti_correlation_outputs(
    params: CiftiCorrelationParamsDict,
    execution: Execution,
): CiftiCorrelationOutputs {
    const ret: CiftiCorrelationOutputs = {
        root: execution.outputFile("."),
        cifti_out: execution.outputFile([(params["cifti-out"] ?? null)].join('')),
    };
    return ret;
}


/**
 * GENERATE CORRELATION OF ROWS IN A CIFTI FILE.
 *
 * For each row (or each row inside an roi if -roi-override is specified), correlate to all other rows.  The -cifti-roi suboption to -roi-override may not be specified with any other -*-roi suboption, but you may specify the other -*-roi suboptions together.
 *
 * When using the -fisher-z option, the output is NOT a Z-score, it is artanh(r), to do further math on this output, consider using -cifti-math.
 *
 * Restricting the memory usage will make it calculate the output in chunks, and if the input file size is more than 70% of the memory limit, it will also read through the input file as rows are required, resulting in several passes through the input file (once per chunk).  Memory limit does not need to be an integer, you may also specify 0 to calculate a single output row at a time (this may be very slow).
 *
 * @param params The parameters.
 * @param runner Command runner
 *
 * @returns NamedTuple of outputs (described in `CiftiCorrelationOutputs`).
 */
function cifti_correlation_execute(
    params: CiftiCorrelationParamsDict,
    runner: Runner | null = null,
): CiftiCorrelationOutputs {
    runner = runner || getGlobalRunner();
    const execution = runner.startExecution(CIFTI_CORRELATION_METADATA);
    params = execution.params(params)
    const cargs = cifti_correlation_cargs(params, execution)
    const ret = cifti_correlation_outputs(params, execution)
    execution.run(cargs, undefined);
    return ret;
}


/**
 * GENERATE CORRELATION OF ROWS IN A CIFTI FILE.
 *
 * For each row (or each row inside an roi if -roi-override is specified), correlate to all other rows.  The -cifti-roi suboption to -roi-override may not be specified with any other -*-roi suboption, but you may specify the other -*-roi suboptions together.
 *
 * When using the -fisher-z option, the output is NOT a Z-score, it is artanh(r), to do further math on this output, consider using -cifti-math.
 *
 * Restricting the memory usage will make it calculate the output in chunks, and if the input file size is more than 70% of the memory limit, it will also read through the input file as rows are required, resulting in several passes through the input file (once per chunk).  Memory limit does not need to be an integer, you may also specify 0 to calculate a single output row at a time (this may be very slow).
 *
 * @param cifti_out output cifti file
 * @param cifti input cifti file
 * @param roi_override perform correlation from a subset of rows to all rows
 * @param weight_file specify column weights

text file containing one weight per column
 * @param fisher_z apply fisher small z transform (ie, artanh) to correlation
 * @param no_demean instead of correlation, do dot product of rows, then normalize by diagonal
 * @param covariance compute covariance instead of correlation
 * @param limit_gb restrict memory usage

memory limit in gigabytes
 * @param runner Command runner
 *
 * @returns NamedTuple of outputs (described in `CiftiCorrelationOutputs`).
 */
function cifti_correlation(
    cifti_out: string,
    cifti: InputPathType,
    roi_override: CiftiCorrelationRoiOverrideParamsDict | null = null,
    weight_file: string | null = null,
    fisher_z: boolean = false,
    no_demean: boolean = false,
    covariance: boolean = false,
    limit_gb: number | null = null,
    runner: Runner | null = null,
): CiftiCorrelationOutputs {
    const params = cifti_correlation_params(cifti_out, cifti, roi_override, weight_file, fisher_z, no_demean, covariance, limit_gb)
    return cifti_correlation_execute(params, runner);
}


export {
      CIFTI_CORRELATION_METADATA,
      CiftiCorrelationOutputs,
      CiftiCorrelationParamsDict,
      CiftiCorrelationParamsDictTagged,
      CiftiCorrelationRoiOverrideParamsDict,
      CiftiCorrelationRoiOverrideParamsDictTagged,
      cifti_correlation,
      cifti_correlation_execute,
      cifti_correlation_params,
      cifti_correlation_roi_override,
};
